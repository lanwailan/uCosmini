/*
************************************************************************************************************************
*                                                 °üº¬µÄÍ·ÎÄ¼þ
************************************************************************************************************************
*/
#include "os.h"
#include "ARMCM3.h"

/*
************************************************************************************************************************
*                                                   ºê¶¨Òå
************************************************************************************************************************
*/


/*
************************************************************************************************************************
*                                                  È«¾Ö±äÁ¿
************************************************************************************************************************
*/

uint32_t flag1;
uint32_t flag2;

/*
************************************************************************************************************************
*                                                  TCB & STACK & ÈÎÎñÉùÃ÷
************************************************************************************************************************
*/
#define  TASK1_STK_SIZE       20
#define  TASK2_STK_SIZE       20

static   CPU_STK   Task1Stk[TASK1_STK_SIZE];
static   CPU_STK   Task2Stk[TASK2_STK_SIZE];

static   OS_TCB    Task1TCB;
static   OS_TCB    Task2TCB;

void     Task1( void *p_arg );
void     Task2( void *p_arg );

/*
************************************************************************************************************************
*                                                  º¯ÊýÉùÃ÷
************************************************************************************************************************
*/
void delay(uint32_t count);

/*
************************************************************************************************************************
*                                                    mainº¯Êý
************************************************************************************************************************
*/
/*
* ×¢ÒâÊÂÏî£º1¡¢¸Ã¹¤³ÌÊ¹ÓÃÈí¼þ·ÂÕæ£¬debugÐèÑ¡Ôñ Ude Simulator
*           2¡¢ÔÚTargetÑ¡Ïî¿¨ÀïÃæ°Ñ¾§ÕñXtal(Mhz)µÄÖµ¸ÄÎª25£¬Ä¬ÈÏÊÇ12£¬
*              ¸Ä³É25ÊÇÎªÁË¸úsystem_ARMCM3.cÖÐ¶¨ÒåµÄ__SYSTEM_CLOCKÏàÍ¬£¬È·±£·ÂÕæµÄÊ±ºòÊ±ÖÓÒ»ÖÂ
*/
int main(void)
{   
    OS_ERR err;
    
    CPU_IntDis();

    OS_CPU_SysTickInit(10);
    
    /* ³õÊ¼»¯Ïà¹ØµÄÈ«¾Ö±äÁ¿ */
    OSInit(&err);
    
    /* ´´½¨ÈÎÎñ */
    OSTaskCreate ((OS_TCB*)      &Task1TCB, 
                  (OS_TASK_PTR ) Task1, 
                  (void *)       0,
                  (CPU_STK*)     &Task1Stk[0],
                  (CPU_STK_SIZE) TASK1_STK_SIZE,
                  (OS_ERR *)     &err);

    OSTaskCreate ((OS_TCB*)      &Task2TCB, 
                  (OS_TASK_PTR ) Task2, 
                  (void *)       0,
                  (CPU_STK*)     &Task2Stk[0],
                  (CPU_STK_SIZE) TASK2_STK_SIZE,
                  (OS_ERR *)     &err);
                  
    /* ½«ÈÎÎñ¼ÓÈëµ½¾ÍÐ÷ÁÐ±í */
    OSRdyList[0].HeadPtr = &Task1TCB;
    OSRdyList[1].HeadPtr = &Task2TCB;
    
    /* Æô¶¯OS£¬½«²»ÔÙ·µ»Ø */                
    OSStart(&err);
}

/*
************************************************************************************************************************
*                                                    º¯ÊýÊµÏÖ
************************************************************************************************************************
*/
/* Èí¼þÑÓÊ± */
void delay (uint32_t count)
{
    for(; count!=0; count--);
}



/* ÈÎÎñ1 */
void Task1( void *p_arg )
{
    for( ;; )
    {
        flag1 = 1;
        delay( 100 );       
        flag1 = 0;
        delay( 100 );
        
        /* ÈÎÎñÇÐ»»£¬ÕâÀïÊÇÊÖ¶¯ÇÐ»» */      
        //OSSched();
    }
}

/* ÈÎÎñ2 */
void Task2( void *p_arg )
{
    for( ;; )
    {
        flag2 = 1;
        delay( 100 );       
        flag2 = 0;
        delay( 100 );
        
        /* ÈÎÎñÇÐ»»£¬ÕâÀïÊÇÊÖ¶¯ÇÐ»» */
        //OSSched();
    }
}


